{% extends 'base.html' %}

{% block title %}æŠ•ç¨¿ãƒ­ã‚° | AIè¨˜äº‹ç”Ÿæˆãƒ„ãƒ¼ãƒ«{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-md-3">
            <nav>
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('main.dashboard') }}">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('main.admin_log') }}">æŠ•ç¨¿ãƒ­ã‚°</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('main.generate_articles') }}">è¨˜äº‹ç”Ÿæˆ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('main.manage_sites') }}">ã‚µã‚¤ãƒˆç®¡ç†</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('main.manage_prompts') }}">ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç®¡ç†</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('main.dashboard_graph') }}">ğŸ“Šã‚°ãƒ©ãƒ•åˆ†æ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('main.logout') }}">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
                    </li>
                </ul>
            </nav>
        </div>

        <div class="col-md-9">
            <h1 class="text-2xl font-bold mb-4">æŠ•ç¨¿ãƒ­ã‚°</h1>

            <!-- ã‚µã‚¤ãƒˆé¸æŠ -->
            <form method="get" class="mb-4">
                <label for="site_id" class="mr-2 text-sm">ã‚µã‚¤ãƒˆé¸æŠ:</label>
                <select name="site_id" id="site_id" onchange="this.form.submit()" class="border rounded p-1 text-sm">
                    {% for site in user_sites %}
                        <option value="{{ site.id }}" {% if site.id == current_site.id %}selected{% endif %}>{{ site.url }}</option>
                    {% endfor %}
                </select>
            </form>

            <!-- æŠ•ç¨¿ä¸€è¦§ -->
            <div class="overflow-x-auto">
                <table class="min-w-full bg-white shadow rounded-lg text-sm">
                    <thead>
                        <tr class="bg-gray-100 text-left">
                            <th class="py-2 px-4">ã‚¿ã‚¤ãƒˆãƒ«</th>
                            <th class="py-2 px-4">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</th>
                            <th class="py-2 px-4">æŠ•ç¨¿äºˆå®šæ—¥æ™‚</th>
                            <th class="py-2 px-4">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                            <th class="py-2 px-4">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for post in posts %}
                        <tr class="border-t hover:bg-gray-50">
                            <td class="py-2 px-4">{{ post.title[:30] }}{% if post.title|length > 30 %}...{% endif %}</td>
                            <td class="py-2 px-4 text-gray-600">{{ post.keyword }}</td>
                            <td class="py-2 px-4 text-gray-600">
                                {{ post.scheduled_time.strftime('%Y-%m-%d %H:%M') if post.scheduled_time else 'æœªè¨­å®š' }}
                            </td>
                            <td class="py-2 px-4">
                                {% if post.posted %}
                                    <span class="bg-green-100 text-green-800 text-xs font-medium px-2 py-1 rounded">æŠ•ç¨¿æ¸ˆã¿</span>
                                {% else %}
                                    <span class="bg-yellow-100 text-yellow-800 text-xs font-medium px-2 py-1 rounded">ç”Ÿæˆæ¸ˆã¿</span>
                                {% endif %}
                            </td>
                            <td class="py-2 px-4 space-x-1">
                                <a href="{{ url_for('main.view_post', post_id=post.id) }}" class="text-blue-600 hover:underline">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</a>
                                <a href="{{ url_for('main.edit_post', post_id=post.id) }}" class="text-yellow-600 hover:underline">ç·¨é›†</a>
                                <a href="{{ url_for('main.delete_post', post_id=post.id) }}" class="text-red-600 hover:underline" onclick="return confirm('å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ');">å‰Šé™¤</a>
                                {% if not post.posted %}
                                    <a href="{{ url_for('main.post_now', post_id=post.id) }}" class="text-green-600 hover:underline">å³æ™‚æŠ•ç¨¿</a>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}

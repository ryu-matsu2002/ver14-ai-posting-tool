<!-- templates/dashboard_graph.html -->
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ダッシュボード：グラフ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

  <div class="flex justify-between items-center mb-4">
    <h2 class="text-xl font-bold">サイト別グラフ分析</h2>
    <form method="get" action="{{ url_for('main.dashboard_graph') }}">
      <select name="site_id" onchange="this.form.submit()" class="border px-2 py-1 rounded">
        {% for site in user_sites %}
          <option value="{{ site.id }}" {% if site.id == current_site.id %}selected{% endif %}>{{ site.url }}</option>
        {% endfor %}
      </select>
    </form>
  </div>

  <div class="flex gap-4 mb-6">
    <a href="{{ url_for('main.dashboard_graph', view='daily', site_id=current_site.id) }}" class="px-4 py-2 bg-blue-500 text-white rounded">日別</a>
    <a href="{{ url_for('main.dashboard_graph', view='weekly', site_id=current_site.id) }}" class="px-4 py-2 bg-green-500 text-white rounded">週別</a>
    <a href="{{ url_for('main.dashboard_graph', view='monthly', site_id=current_site.id) }}" class="px-4 py-2 bg-purple-500 text-white rounded">月別</a>
  </div>
  
    <h1>📊 日別投稿数・API使用量</h1>

    <canvas id="articleChart" width="600" height="300"></canvas>
    <canvas id="tokenChart" width="600" height="300" style="margin-top: 50px;"></canvas>

    <script>
      const labels = JSON.parse('{{ labels | tojson | safe }}');
      const articleCounts = JSON.parse('{{ article_counts | tojson | safe }}');
      const tokenCounts = JSON.parse('{{ token_counts | tojson | safe }}');
    
      new Chart(document.getElementById('articleChart'), {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: '記事数',
            data: articleCounts,
            borderColor: 'blue',
            borderWidth: 2,
            fill: false
          }]
        }
      });
    
      new Chart(document.getElementById('tokenChart'), {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'API使用トークン数',
            data: tokenCounts,
            borderColor: 'orange',
            borderWidth: 2,
            fill: false
          }]
        }
      });
    </script>
    
</body>
</html>
